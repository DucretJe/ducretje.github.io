---
layout: post
title:  "HTB: Shoppy"
category: box
title: "HTB: Shoppy"
subtitle: Walkthrough
accent_image: /assets/img/blog/htb.jpg
image:
  path:    /assets/img/blog/shoppy/Shoppy.png
---
Box by [lockscan](https://app.hackthebox.com/users/217870)
{:.faded}

Retired box, available [here](https://app.hackthebox.com/machines/496)  
It's not my first box, I've done a few others before, but I neglected to write a walkthrough for them. That being said, I'm still a newbie, or, as some might say, a "script kiddie". That's okay; learning takes time, but it's worth it.

* this unordered seed list will be replaced by the toc
{:toc}

## Port scanning

### Initial scan

I'm trying [rustscan](https://github.com/RustScan/RustScan) for the first time on this box, instead of the well-known [nmap](https://nmap.org/).  
I'm feeling confident, so I'm starting with:

```bash
rustscan -a 10.10.11.180 --  -sV --open -oA /nmap/initial/initial_scan 
```
```plain
PORT   STATE SERVICE REASON         VERSION
22/tcp open  ssh     syn-ack ttl 62 OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)
80/tcp open  http    syn-ack ttl 62 nginx 1.23.1
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

Interesting, we get the common services: a **webpage** and **SSH**. From my experience, the SSH service allows us to connect using credentials we obtain from the webpage.
{:.note title="ðŸ’­ Thoughs"}

I noticed `9093` port appearing once. I persisted.

```bash
rustscan -a 10.10.11.180 -p 9093 --  -sV -oA /nmap/initial/initial_scan
```
```plain
9093/tcp open  copycat? syn-ack ttl 62
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port9093-TCP:V=7.80%I=7%D=12/31%Time=63B01359%P=x86_64-alpine-linux-mus
SF:l%r(GenericLines,67,"HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Type
SF::\x20text/plain;\x20charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x2
SF:0Bad\x20Request")%r(GetRequest,2F0E,"HTTP/1\.0\x20200\x20OK\r\nContent-
SF:Type:\x20text/plain;\x20version=0\.0\.4;\x20charset=utf-8\r\nDate:\x20S
SF:at,\x2031\x20Dec\x202022\x2010:47:58\x20GMT\r\n\r\n#\x20HELP\x20go_gc_c
SF:ycles_automatic_gc_cycles_total\x20Count\x20of\x20completed\x20GC\x20cy
SF:cles\x20generated\x20by\x20the\x20Go\x20runtime\.\n#\x20TYPE\x20go_gc_c
SF:ycles_automatic_gc_cycles_total\x20counter\ngo_gc_cycles_automatic_gc_c
SF:ycles_total\x2019\n#\x20HELP\x20go_gc_cycles_forced_gc_cycles_total\x20
SF:Count\x20of\x20completed\x20GC\x20cycles\x20forced\x20by\x20the\x20appl
SF:ication\.\n#\x20TYPE\x20go_gc_cycles_forced_gc_cycles_total\x20counter\
SF:ngo_gc_cycles_forced_gc_cycles_total\x200\n#\x20HELP\x20go_gc_cycles_to
SF:tal_gc_cycles_total\x20Count\x20of\x20all\x20completed\x20GC\x20cycles\
SF:.\n#\x20TYPE\x20go_gc_cycles_total_gc_cycles_total\x20counter\ngo_gc_cy
SF:cles_total_gc_cycles_total\x2019\n#\x20HELP\x20go_gc_duration_seconds\x
SF:20A\x20summary\x20of\x20the\x20pause\x20duration\x20of\x20garbage\x20co
SF:llection\x20cycles\.\n#\x20TYPE\x20go_gc_duration_seconds\x20summary\ng
SF:o_gc_duration_seconds{quantile=\"0\"}\x203\.8703e-05\ngo_gc_duration_se
SF:conds{quantile=\"0\.25\"}\x200\.000117581\ngo_gc_")%r(HTTPOptions,2A5A,
SF:"HTTP/1\.0\x20200\x20OK\r\nContent-Type:\x20text/plain;\x20version=0\.0
SF:\.4;\x20charset=utf-8\r\nDate:\x20Sat,\x2031\x20Dec\x202022\x2010:47:58
SF:\x20GMT\r\n\r\n#\x20HELP\x20go_gc_cycles_automatic_gc_cycles_total\x20C
SF:ount\x20of\x20completed\x20GC\x20cycles\x20generated\x20by\x20the\x20Go
SF:\x20runtime\.\n#\x20TYPE\x20go_gc_cycles_automatic_gc_cycles_total\x20c
SF:ounter\ngo_gc_cycles_automatic_gc_cycles_total\x2019\n#\x20HELP\x20go_g
SF:c_cycles_forced_gc_cycles_total\x20Count\x20of\x20completed\x20GC\x20cy
SF:cles\x20forced\x20by\x20the\x20application\.\n#\x20TYPE\x20go_gc_cycles
SF:_forced_gc_cycles_total\x20counter\ngo_gc_cycles_forced_gc_cycles_total
SF:\x200\n#\x20HELP\x20go_gc_cycles_total_gc_cycles_total\x20Count\x20of\x
SF:20all\x20completed\x20GC\x20cycles\.\n#\x20TYPE\x20go_gc_cycles_total_g
SF:c_cycles_total\x20counter\ngo_gc_cycles_total_gc_cycles_total\x2019\n#\
SF:x20HELP\x20go_gc_duration_seconds\x20A\x20summary\x20of\x20the\x20pause
SF:\x20duration\x20of\x20garbage\x20collection\x20cycles\.\n#\x20TYPE\x20g
SF:o_gc_duration_seconds\x20summary\ngo_gc_duration_seconds{quantile=\"0\"
SF:}\x203\.8703e-05\ngo_gc_duration_seconds{quantile=\"0\.25\"}\x200\.0001
SF:17581\ngo_gc_");
```

I'm not sure what copycat is ðŸ˜…. Let's see if we can get a banner or something.
{:.note title="ðŸ’­ Thoughs"}

```bash
telnet 10.10.11.180 9093
```

Nothing to report, but I have bigger fish to fry. I took a look at the exploits available for the versions of `nginx` and `OpenSSH`, but didn't find anything particularly interesting. Here are my findings:

* [Nginx (no RCE)](https://www.tenable.com/plugins/was/113421)
* [OpenSSH has a RCE vuln](https://www.cybersecurity-help.cz/vdb/SB2021031404) but it requires to trick the users on the server side, useless here.

I'm eager to open my browser and get going, but first, let's do some more thorough scans.


### Full scan

Let's do a full scan. It's an easy VM, so I doubt we'll find anything. But, you never know!

```bash
rustscan -a 10.10.11.180 --range 1-65535 -T 2000 -- --open -oA /nmap/full/full_tcp_scan
```

Nothing more! I have other scans to run, though.

### Script scans

To be honest, those scripts never helped me, but `nmap` is really famous for it, so let's take it as a habit. To make it work, I'll probably have to follow the redirections of the webpage. I already got it in another box, so I added the DNS entry `shoppy.htb` to `/etc/hosts` and continued with my scan.

First, I fired the standard scripts set.

```bash
rustscan -t 5000 -a shoppy.htb -p 22,80,9093 -- -sC -oA /nmap/scripts/script_scan
```
```plain
22/tcp   open  ssh     syn-ack ttl 62
80/tcp   open  http    syn-ack ttl 62
|_http-favicon: Unknown favicon MD5: D5F0A0ADD0BFBB2BC51607F78ECE2F57
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-title:             Shoppy Wait Page        
9093/tcp open  copycat syn-ack ttl 62
```

Nothing particularly interesting is happening right now.
{:.note title="ðŸ’­ Thoughs"}

Then, I run the vulnerability scripts:

```bash
rustscan -t 5000 -a shoppy.htb -p 22,80,9093 --  -oA /nmap/scripts/script_scan --script vuln
```
```
PORT     STATE SERVICE REASON
22/tcp   open  ssh     syn-ack ttl 62
|_clamav-exec: ERROR: Script execution failed (use -d to debug)
80/tcp   open  http    syn-ack ttl 62
|_clamav-exec: ERROR: Script execution failed (use -d to debug)
|_http-csrf: Couldn't find any CSRF vulnerabilities.
|_http-dombased-xss: Couldn't find any DOM based XSS.
| http-enum: 
|_  /login/: Login page
|_http-jsonp-detection: Couldn't find any JSONP endpoints.
|_http-litespeed-sourcecode-download: Request with null byte did not work. This web server might not be vulnerable
|_http-stored-xss: Couldn't find any stored XSS vulnerabilities.
| http-vuln-cve2011-3192: 
|   VULNERABLE:
|   Apache byterange filter DoS
|     State: VULNERABLE
|     IDs:  BID:49303  CVE:CVE-2011-3192
|       The Apache web server is vulnerable to a denial of service attack when numerous
|       overlapping byte ranges are requested.
|     Disclosure date: 2011-08-19
|     References:
|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-3192
|       https://www.tenable.com/plugins/nessus/55976
|       https://seclists.org/fulldisclosure/2011/Aug/175
|_      https://www.securityfocus.com/bid/49303
|_http-wordpress-users: [Error] Wordpress installation was not found. We couldn't find wp-login.php
9093/tcp open  copycat syn-ack ttl 62
|_clamav-exec: ERROR: Script execution failed (use -d to debug)
```

This one is more interesting. As expected, the 22 port is likely not our entry point, but the web server appears to be more promising.
{:.note title="ðŸ’­ Thoughs"}

What We Learned:

- There is a `/login/` page
- Most of the scripts failed
- There is a vulnerability that allows for a DDOS attack, but we will not be testing it here.

Therefore, let's continue with the `auth` scripts.

```bash
rustscan -t 5000 -a shoppy.htb -p 22,80,9093 --  -oA /nmap/scripts/script_scan --script auth
```
```plain
PORT     STATE SERVICE REASON
22/tcp   open  ssh     syn-ack ttl 62
| ssh-auth-methods: 
|   Supported authentication methods: 
|     publickey
|_    password
| ssh-publickey-acceptance: 
|_  Accepted Public Keys: No public keys accepted
80/tcp   open  http    syn-ack ttl 62
|_http-wordpress-users: [Error] Wordpress installation was not found. We couldn't find wp-login.php
9093/tcp open  copycat syn-ack ttl 62
```

No obvious open doors here ðŸ˜¢.   
Let's give our `exploit` scripts a try.

```bash
rustscan -t 5000 -a shoppy.htb -p 22,80,9093 --  -oA /nmap/scripts/script_scan --script exploit
```
```plain
PORT     STATE SERVICE REASON
22/tcp   open  ssh     syn-ack ttl 62
|_clamav-exec: ERROR: Script execution failed (use -d to debug)
80/tcp   open  http    syn-ack ttl 62
|_clamav-exec: ERROR: Script execution failed (use -d to debug)
|_http-csrf: Couldn't find any CSRF vulnerabilities.
|_http-dombased-xss: Couldn't find any DOM based XSS.
|_http-litespeed-sourcecode-download: Request with null byte did not work. This web server might not be vulnerable
|_http-stored-xss: Couldn't find any stored XSS vulnerabilities.
9093/tcp open  copycat syn-ack ttl 62
|_clamav-exec: ERROR: Script execution failed (use -d to debug)
```

No, it won't be simple! ðŸ˜ˆ

### Enum HTTP

Let's delve deeper into the HTTP service and learn more about what it offers:

```bash
rustscan -t 5000 -a shoppy.htb -p 80 -- -sV --script=http-enum -oA /nmap/enum/nmap_http_enum
```
```plain
PORT   STATE SERVICE REASON         VERSION
80/tcp open  http    syn-ack ttl 62 nginx 1.23.1
| http-enum: 
|_  /login/: Login page
|_http-server-header: nginx/1.23.1
```

We already know that, but let's see what it looks like!

![Full-width image](/assets/img/blog/shoppy/homepage.png){:.lead width="800" height="100" loading="lazy"}

The homepage is just a countdown, nothing to see there...
{:.figcaption}

![Full-width image](/assets/img/blog/shoppy/loginpage.png){:.lead width="800" height="100" loading="lazy"}

A login page. `admin:admin` don't work
{:.figcaption}

### Enum SSH

I no longer have faith in this, but let's be thorough.

```bash
rustscan -t 5000 -a shoppy.htb -p 22 -- -sV --script=ssh-* -oA /nmap/enum/nmap_http_enum
```

Nothing interesting.

### Scans wrap up

| Open Port | Software and version                          | Exploit |
|-----------|:----------------------------------------------|:-------:|
| 80        | nginx 1.23.1                                  | No      |
| 22        | OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0) | No      |
| 9093      | Copycat ??                                    | No      |

## Foothold

### Attempt #1

Without any hint for the username nor the password I decide to use `ffuz` to discover some hidden places there

#### FFUZ

First let's try with the subdomains.

```bash
ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt:FUZZ -u http://shoppy.htb:80/ -H 'Host: FUZZ.shoppy.htb' -fs 169
```

Found nothing.
It's a bit overkill since we only have one page but I want to practice a bit, and use `ffuz` to find an eventual **index** page.

> Is it obvious that I just finished the `ffuz` module on [HackTheBox Academy](https://academy.hackthebox.com) ðŸ¤“ ?

```bash
ffuf -w /usr/share/seclists/Discovery/Web-Content/web-extensions.txt:FUZZ -u http://shoppy.htb:80/login/indexFUZZ;
```

Nothing.

